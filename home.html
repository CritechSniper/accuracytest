<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Accuracy Test</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');

    :root {
      --base-clr: #11121a;
      --line-clr: #42434a;
      --hover-clr: #222533;
      --text-clr: #e6e6ef;
      --acent-clr: #5e63ff;
      --secondary-text-clr: #b0b3c1;
      --btn-hover-clr: hsl(240, 100%, 75%);
      --btn-clr: hsl(240, 100%, 70%);
    }

    * {
      box-sizing: border-box;
      padding: 0;
      margin: 0;
      font-family: 'Poppins', sans-serif;
    }

    body {
      background-color: var(--base-clr);
      color: var(--text-clr);
      text-align: center;
      padding: 30px;
      margin: 0;
    }

    h1 {
      margin-bottom: 10px;
      font-weight: 600;
    }

		#gameArea {
			position: relative;
      width: 500px;
      height: 500px;
			margin: 20px auto;
			border: 2px solid var(--line-clr);
			background-color: var(--hover-clr);
			border-radius: 10px;
			overflow: hidden;
		}

		#gameArea::after {
			content: "";
			position: absolute;
			display: none;
			width: fit-content;
			height: 40px;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			font-size: xx-large;
			color: var(--text-clr);
			z-index: 9999;
		}


		#gameArea.countdown-active::after {
			display: block;
			animation: changeName 4s ease-in-out forwards;
		}

		@keyframes changeName {
			0%   { content: "Ready?"; }
			25%  { content: "3"; }
			50%  { content: "2"; }
			75%  { content: "1"; }
			100% { content: "Go!"; }
		}

    #box {
      width: 50px;
      height: 50px;
      background-color: var(--acent-clr);
      position: absolute;
      cursor: pointer;
      border-radius: 6px;
      display: none;
      transition: background-color 0.2s;
    }

    #box:hover {
      background-color: var(--btn-hover-clr);
    }

    #score, #timer {
      font-size: 20px;
      margin: 10px 0;
      color: var(--secondary-text-clr);
    }

    button {
      padding: 10px 25px;
      font-size: 18px;
      background-color: var(--btn-clr);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s;
      margin: 10px;
    }

    button:hover {
      background-color: var(--btn-hover-clr);
    }

    #modal {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0, 0, 0, 0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 10;
    }

    #modalContent {
      background-color: var(--hover-clr);
      padding: 30px;
      border-radius: 10px;
      text-align: center;
      color: var(--text-clr);
      max-width: 300px;
      width: 90%;
    }

    #highScore {
      margin-top: 10px;
      color: var(--secondary-text-clr);
			font-size: small;
    }

    #leaderboard {
      margin-top: 30px;
    }

    #leaderboard ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .leaderboard-item {
      color: var(--secondary-text-clr);
      margin: 3px 0;
    }

    #initialInput {
      margin: 10px 0;
      padding: 8px;
      font-size: 16px;
      border-radius: 5px;
      border: 1px solid var(--line-clr);
      background-color: var(--base-clr);
      color: var(--text-clr);
      text-align: center;
      width: 100px;
			height: 47px;
    }

    #endGameBtn {
      display: none;
    }

    #timePopup button {
      margin: 5px;
      padding: 6px 12px;
      background: var(--hover-clr);
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    #timePopup button:hover {
      background: var(--btn-hover-clr);
    }

    .close-modal-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      background-color: #e63946;
      border: none;
      font-size: 24px;
      color: white;
      padding: 1px 10px;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }

    .close-modal-btn:hover {
      background-color: #d62828;
      box-shadow: 0 6px 10px rgba(0, 0, 0, 0.3);
    }
		#nextBox {
			position: absolute;
			width: 50px;
			height: 50px;
			background-color: rgba(255, 255, 255, 0.3);
			border: 2px dashed #fff;
			pointer-events: none;
			display: none;
			animation: nextposition 0.3s ease-in-out forwards;
			transform-origin: center center;
		}

		@keyframes nextposition {
			from {
				opacity: 0;
				scale: 1.5;
			}
			to {
				opacity: 1;
				scale: 1;
			}
		}
  </style>
</head>
<body>

  <h1>üéØ Is Your Accuracy Good?</h1>
  <input id="initialInput" maxlength="3" placeholder="NME" />
  <button id="startBtn">Start Game</button>
  <button id="endGameBtn">End Game</button>
  <div id="timer">Time Left: 30s</div>
  <div id="score">Score: 0</div>

  <button id="setTimeBtn">Set Time</button>
  <div id="timePopup" style="display:none; position:absolute; background:#222; padding:10px; border-radius:6px; z-index:100;">
    <button class="timeOption" data-time="5">5s</button>
    <button class="timeOption" data-time="10">10s</button>
    <button class="timeOption" data-time="15">15s</button>
    <button class="timeOption" data-time="30">30s</button>
    <button class="timeOption" data-time="60">1m</button>
  </div>

  <div id="gameArea">
    <div id="box"></div>
		<div id="nextBox"></div>
  </div>

  <div id="modal">
    <div id="modalContent">
      <button id="closeModalBtn" class="close-modal-btn">&times;</button>
      <h2>Game Over!</h2>
      <p id="finalScore">Your final score is 0.</p>
      <button id="restartBtn">Play Again</button>
    </div>
  </div>

  <div id="leaderboard">
    <h3>üèÜ Leaderboard</h3>
    <ul id="leaderboardList"></ul>
    <button onclick="clearLeaderboard()">Clear Leaderboard</button>
  </div>

  <script>
		const box = document.getElementById('box');
		const nextBox = document.getElementById('nextBox');
		const gameArea = document.getElementById('gameArea');
		const scoreDisplay = document.getElementById('score');
		const timerDisplay = document.getElementById('timer');
		const startBtn = document.getElementById('startBtn');
		const modal = document.getElementById('modal');
		const finalScore = document.getElementById('finalScore');
		const restartBtn = document.getElementById('restartBtn');
		const setTimeBtn = document.getElementById('setTimeBtn');
		const timePopup = document.getElementById('timePopup');
		const initialInput = document.getElementById('initialInput');
		const endGameBtn = document.getElementById('endGameBtn');

		let score = 0;
		let timeLeft;
		let selectedTime = 30;
		let gameInterval;
		let moveInterval;
		let moveSpeed = 1000;
		let gameRunning = false;

		let nextX = 0;
		let nextY = 0;

		// Save the name to localStorage
		function savePlayerName() {
			const name = document.getElementById('initialInput').value.trim();
			if (name) {
				localStorage.setItem('playerName', name);
			}
		}
		// Load the player's name from localStorage
		function loadPlayerName() {
			const savedName = localStorage.getItem('playerName');
			if (savedName) {
				document.getElementById('initialInput').value = savedName;
			}
		}

		// Call this when the page loads
		document.addEventListener('DOMContentLoaded', loadPlayerName);


		function generateNextPosition() {
			const maxX = gameArea.clientWidth - box.clientWidth;
			const maxY = gameArea.clientHeight - box.clientHeight;
			nextX = Math.floor(Math.random() * maxX);
			nextY = Math.floor(Math.random() * maxY);

			// Move the nextBox
			nextBox.style.left = nextX + 'px';
			nextBox.style.top = nextY + 'px';

			// Restart the animation by forcing reflow
			nextBox.style.animation = 'none';
			nextBox.offsetHeight; // Trigger reflow
			nextBox.style.animation = 'nextposition 0.3s ease-in-out forwards';
		}


		function moveBoxToNext() {
			box.style.left = nextX + 'px';
			box.style.top = nextY + 'px';
			generateNextPosition(); // Show new nextBox
		}

		function triggerCountdownAnimation() {
			const gameArea = document.getElementById('gameArea');

			// ‚úÖ Request fullscreen as soon as countdown starts
			if (document.documentElement.requestFullscreen) {
				document.documentElement.requestFullscreen();
			}

			// Show the countdown animation
			gameArea.classList.add('countdown-active');

			// Start the game after countdown
			setTimeout(() => {
				gameArea.classList.remove('countdown-active');
				startGame(); // Now starts after countdown
			}, 5000);
		}



		startBtn.addEventListener('click', triggerCountdownAnimation);
		restartBtn.addEventListener('click', triggerCountdownAnimation);


		function startGame() {
			score = 0;
			timeLeft = selectedTime;
			moveSpeed = 1000;
			gameRunning = true;
			scoreDisplay.textContent = 'Score: 0';
			timerDisplay.textContent = `Time Left: ${timeLeft}s`;
			box.style.display = 'block';
			nextBox.style.display = 'block';
			modal.style.display = 'none';
			setTimeBtn.style.display = 'none';
			startBtn.style.display = 'none';
			initialInput.style.display = 'none';
			endGameBtn.style.display = 'inline-block';
			document.getElementById('leaderboard').style.display = 'none';

			generateNextPosition(); // Initial next location
			moveBoxToNext();        // Move box to first location
			savePlayerName() 				// Save players name

			clearInterval(moveInterval);
			moveInterval = setInterval(moveBoxToNext, moveSpeed);

			clearInterval(gameInterval);
			gameInterval = setInterval(() => {
				timeLeft--;
				timerDisplay.textContent = `Time Left: ${timeLeft}s`;

				if (timeLeft % 5 === 0 && moveSpeed > 300) {
					moveSpeed -= 100;
					clearInterval(moveInterval);
					moveInterval = setInterval(moveBoxToNext, moveSpeed);
				}

				if (timeLeft <= 0) {
					endGame();
				}
			}, 1000);

			if (document.documentElement.requestFullscreen) {
				document.documentElement.requestFullscreen();
			}
		}

		function endGame() {
			gameRunning = false;
			clearInterval(gameInterval);
			clearInterval(moveInterval);
			box.style.display = 'none';
			nextBox.style.display = 'none';
			finalScore.textContent = `Your final score is ${score}.`;
			timerDisplay.textContent = `Time Left: ${selectedTime}s`;
			modal.style.display = 'flex';

			endGameBtn.style.display = 'none';
			setTimeBtn.style.display = 'inline-block';
			startBtn.style.display = 'inline-block';
			initialInput.style.display = 'inline-block';
			document.getElementById('leaderboard').style.display = 'block';


			const storedHigh = localStorage.getItem('highScore') || 0;
			if (score > storedHigh) {
				localStorage.setItem('highScore', score);
			}

			updateHighScoreUI();
			updateLeaderboard(score);
		}

		function handleBoxClick() {
			if (!gameRunning) return;
			score++;
			scoreDisplay.textContent = 'Score: ' + score;

			moveBoxToNext();

			clearInterval(moveInterval);
			moveInterval = setInterval(moveBoxToNext, moveSpeed);
		}

		startBtn.addEventListener('click', () => {
			document.getElementById('gameArea').classList.add('countdown-active');

			setTimeout(() => {
				document.getElementById('gameArea').classList.remove('countdown-active');
				startGame();
			}, 4000); // Match this with your CSS animation duration
		});

		restartBtn.addEventListener('click', startGame);
		box.addEventListener('click', handleBoxClick);

		function updateHighScoreUI() {
			const hs = localStorage.getItem('highScore') || 0;
			let hsEl = document.getElementById('highScore');
			if (!hsEl) {
				hsEl = document.createElement('div');
				hsEl.id = 'highScore';
				// hsEl.style.marginTop = '10px';
				// hsEl.style.color = 'var(--secondary-text-clr)';
				scoreDisplay.insertAdjacentElement('afterend', hsEl);
			}
			hsEl.textContent = `High Score: ${hs}`;
		}

		function updateLeaderboard(score) {
			const name = initialInput.value.trim().toUpperCase() || "???";

			let leaderboard = JSON.parse(localStorage.getItem('leaderboard') || '[]');

			// Ensure all entries are objects, even old ones
			leaderboard = leaderboard.filter(entry => typeof entry === 'object' && entry.name && typeof entry.score === 'number');

			leaderboard.push({ name, score });
			leaderboard.sort((a, b) => b.score - a.score);
			leaderboard = leaderboard.slice(0, 5);
			localStorage.setItem('leaderboard', JSON.stringify(leaderboard));
			renderLeaderboard(leaderboard);
		}




		function renderLeaderboard(leaderboard) {
			const list = document.getElementById('leaderboardList');
			list.innerHTML = '';
			leaderboard.forEach((entry, index) => {
				const li = document.createElement('li');
				li.textContent = `${ordinal(index + 1)} - ${entry.name}: ${entry.score}`;
				li.className = 'leaderboard-item';
				list.appendChild(li);
			});
		}

		function ordinal(n) {
			const s = ["th", "st", "nd", "rd"], v = n % 100;
			return n + (s[(v - 20) % 10] || s[v] || s[0]);
		}

		function clearLeaderboard() {
			localStorage.removeItem('leaderboard');
			localStorage.removeItem('highScore');
			renderLeaderboard([]);
			updateHighScoreUI();
		}



		setTimeBtn.addEventListener('click', (e) => {
			timePopup.style.display = timePopup.style.display === 'none' ? 'block' : 'none';
			const rect = setTimeBtn.getBoundingClientRect();
			timePopup.style.left = rect.left + 'px';
			timePopup.style.top = rect.bottom + 5 + 'px';
		});

		document.querySelectorAll('.timeOption').forEach(btn => {
			btn.addEventListener('click', () => {
				selectedTime = parseInt(btn.dataset.time);
				timePopup.style.display = 'none';

				// ‚úÖ Update the time display immediately
				setInterval (timerDisplay.textContent = `Time Left: ${selectedTime}s`, 10)
				timerDisplay.textContent = `Time Left: ${selectedTime}s`;
			});
		});


		document.addEventListener('click', (e) => {
			if (!setTimeBtn.contains(e.target) && !timePopup.contains(e.target)) {
				timePopup.style.display = 'none';
			}
		});

		endGameBtn.addEventListener('click', () => {
			if (gameRunning) endGame();
		});

		const closeModalBtn = document.getElementById('closeModalBtn');
		closeModalBtn.addEventListener('click', () => {
			modal.style.display = 'none';
		});

		// Ensure leaderboard is shown and populated on page load
		document.addEventListener('DOMContentLoaded', () => {
			const leaderboardEl = document.getElementById('leaderboard');
			leaderboardEl.style.display = 'block';

			const stored = JSON.parse(localStorage.getItem('leaderboard') || '[]');
			renderLeaderboard(stored);
			updateHighScoreUI();
		});

  </script>
</body>
</html>